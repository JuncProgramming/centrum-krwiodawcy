import{c as w,j as e,r as h,X as T,S as P,y,s as z,R as I,a as B}from"./index-COGczvqV.js";import{M as S,n as F,a as K,T as A,g as H,c as q}from"./utils-B_Pgu3T7.js";import{C as R}from"./chevron-down-CiQheI1H.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],G=w("activity",Z);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],U=w("calendar",V);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]],M=w("droplet",W);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],J=w("file-text",Y);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Q=w("hash",X);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],se=w("info",ee);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],ne=w("map-pin",te);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]],L=w("medal",ae);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],ie=w("paperclip",re);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],oe=w("plus",le);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ce=w("trash-2",de);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],xe=w("triangle-alert",me);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],he=w("upload",ue);function C({title:s,children:r}){return e.jsxs("section",{className:"p-6 border border-zinc-200 shadow-sm rounded-lg bg-zinc-50 flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("h3",{className:"text-xl font-semibold text-zinc-800",children:s})}),r]})}function pe({onClose:s,onSave:r}){const m=h.useMemo(()=>new Date().toISOString().split("T")[0],[]),[t,o]=h.useState(m),[a,n]=h.useState("Krew pełna"),[d,c]=h.useState(450),[l,x]=h.useState("RCKiK Warszawa"),[p,j]=h.useState(null),[g,k]=h.useState(!1),[D,f]=h.useState(!1);h.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]);const u=async i=>{if(i.preventDefault(),d<=0){y.error("Ilość oddanej krwi musi być większa od 0ml");return}k(!0);try{await r({date:t,type:a,location:l,amount:d,file:p}),s()}finally{k(!1)}},b=i=>{n(i),i==="Krew pełna"&&c(450),i==="Osocze"&&c(650),i==="Płytki krwi"&&c(500)},N=i=>{if(i.target.files&&i.target.files[0]){const O=i.target.files[0];if(O.size>S){y.error("Plik jest za duży (max. 2 MB)"),i.target.value="";return}j(O)}},v=i=>{i.preventDefault(),f(!0)},_=i=>{i.preventDefault(),f(!1)},$=i=>{i.preventDefault(),f(!1),i.dataTransfer.files&&i.dataTransfer.files[0]&&j(i.dataTransfer.files[0])};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity animate-in fade-in duration-200",onClick:s,"aria-hidden":"true"}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center sm:p-6",children:e.jsxs("div",{className:"relative p-4 sm:p-6 transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 w-full max-w-lg animate-in zoom-in-95 duration-200",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"flex border-b border-zinc-200 pb-4 mb-4 justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-bold text-zinc-800",children:"Dodaj nową donację"}),e.jsx("button",{onClick:s,className:"p-2 rounded-md text-zinc-600 hover:text-zinc-800 transition-colors",children:e.jsx(T,{size:20})})]}),e.jsx("form",{onSubmit:u,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"date",className:"mb-1 font-medium text-zinc-600",children:"Data donacji"}),e.jsx("input",{type:"date",id:"date",required:!0,value:t,max:t,onChange:i=>o(i.target.value),className:"w-full p-2 border border-zinc-300 rounded-md focus:ring-red-500 focus:border-red-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-1 font-medium text-zinc-600",children:"Typ donacji"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-stretch",children:[e.jsxs("label",{className:"flex-1 flex items-center p-2.5 border border-zinc-300 rounded-md cursor-pointer hover:bg-zinc-50 transition-colors min-w-0",children:[e.jsx("input",{type:"radio",name:"donationType",value:"Krew pełna",checked:a==="Krew pełna",onChange:i=>b(i.target.value),className:"w-4 h-4 text-red-600 focus:ring-red-500 shrink-0"}),e.jsx("span",{className:"ml-2 text-sm text-zinc-700 truncate",children:"Krew pełna"})]}),e.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${a==="Krew pełna"?"w-24 opacity-100 ml-2":"w-0 opacity-0 ml-0"}`,children:e.jsxs("div",{className:"w-24 relative h-full",children:[e.jsx("input",{type:"number",value:d,onChange:i=>c(Number(i.target.value)),className:"w-full h-full p-3 pr-8 border border-zinc-300 rounded-md text-center font-medium text-zinc-700 bg-white hover:bg-zinc-50 transition-all focus:outline-none"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs font-medium text-zinc-400 pointer-events-none",children:"ml"})]})})]}),e.jsxs("div",{className:"flex items-stretch",children:[e.jsxs("label",{className:"flex-1 flex items-center p-2.5 border border-zinc-300 rounded-md cursor-pointer hover:bg-zinc-50 transition-colors min-w-0",children:[e.jsx("input",{type:"radio",name:"donationType",value:"Osocze",checked:a==="Osocze",onChange:i=>b(i.target.value),className:"w-4 h-4 text-red-600 focus:ring-red-500 shrink-0"}),e.jsx("span",{className:"ml-2 text-sm text-zinc-700 truncate",children:"Osocze (Plazma)"})]}),e.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${a==="Osocze"?"w-24 opacity-100 ml-2":"w-0 opacity-0 ml-0"}`,children:e.jsxs("div",{className:"w-24 relative h-full",children:[e.jsx("input",{type:"number",value:d,onChange:i=>c(Number(i.target.value)),className:"w-full h-full p-3 pr-8 border border-zinc-300 rounded-md text-center font-medium text-zinc-700 bg-white hover:bg-zinc-50 transition-all focus:outline-none"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs font-medium text-zinc-400 pointer-events-none",children:"ml"})]})})]}),e.jsxs("div",{className:"flex items-stretch",children:[e.jsxs("label",{className:"flex-1 flex items-center p-2.5 border border-zinc-300 rounded-md cursor-pointer hover:bg-zinc-50 transition-colors min-w-0",children:[e.jsx("input",{type:"radio",name:"donationType",value:"Płytki krwi",checked:a==="Płytki krwi",onChange:i=>b(i.target.value),className:"w-4 h-4 text-red-600 focus:ring-red-500 shrink-0"}),e.jsx("span",{className:"ml-2 text-sm text-zinc-700 truncate",children:"Płytki krwi (Trombocyty)"})]}),e.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${a==="Płytki krwi"?"w-24 opacity-100 ml-2":"w-0 opacity-0 ml-0"}`,children:e.jsxs("div",{className:"w-24 relative h-full",children:[e.jsx("input",{type:"number",value:d,onChange:i=>c(Number(i.target.value)),className:"w-full h-full p-3 pr-8 border border-zinc-300 rounded-md text-center font-medium text-zinc-700 bg-white hover:bg-zinc-50 transition-all focus:outline-none"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs font-medium text-zinc-400 pointer-events-none",children:"ml"})]})})]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"location",className:"mb-1 font-medium text-zinc-600",children:"Miejsce (Punkt)"}),e.jsx("input",{type:"text",id:"location",required:!0,value:l,onChange:i=>x(i.target.value),placeholder:"np. RCKiK Kraków",className:"w-full p-2 border border-zinc-300 rounded-md focus:ring-red-500 focus:border-red-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-1 font-medium text-zinc-600",children:"Wyniki badań (opcjonalne)"}),e.jsxs("label",{htmlFor:"file",onDragOver:v,onDragLeave:_,onDrop:$,className:`flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer transition-colors ${D?"border-red-500 bg-red-50":"border-zinc-300 bg-zinc-50 hover:bg-zinc-100"}`,children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(he,{className:"w-8 h-8 mb-2 text-zinc-400"}),e.jsx("p",{className:"mb-2 text-sm text-zinc-500",children:e.jsx("span",{className:"font-semibold",children:"Kliknij lub upuść plik"})}),e.jsx("p",{className:"text-xs text-zinc-500",children:"PDF, JPG, PNG (max. 2MB)"})]}),e.jsx("input",{id:"file",type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:N})]}),p&&e.jsxs("p",{className:"mt-2 text-sm text-zinc-600",children:["Wybrano plik:"," ",e.jsx("span",{className:"font-semibold",children:p.name})]})]}),e.jsxs("button",{type:"submit",disabled:g,className:"w-full bg-red-600 text-white font-semibold py-3 rounded-md hover:bg-red-700 transition-colors flex justify-center items-center gap-2 disabled:opacity-70",children:[g&&e.jsx(P,{size:"sm"}),g?"Zapisywanie...":"Zapisz"]})]})})]})})]})}function fe({onClose:s,onConfirm:r,title:m,description:t,confirmLabel:o="Potwierdź",confirmLoadingLabel:a="Przetwarzanie",cancelLabel:n="Anuluj",variant:d="danger"}){const[c,l]=h.useState(!1);h.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]);const x=async()=>{l(!0);try{await r(),s()}finally{l(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity animate-in fade-in duration-200",onClick:c?void 0:s,"aria-hidden":"true"}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center sm:p-6",children:e.jsxs("div",{className:"relative p-4 sm:p-6 transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 w-full max-w-lg animate-in zoom-in-95 duration-200",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"flex border-b border-zinc-200 pb-4 mb-4 justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-bold text-zinc-800",children:m}),e.jsx("button",{onClick:s,disabled:c,className:"p-2 rounded-md text-zinc-600 hover:text-zinc-800 transition-colors",children:e.jsx(T,{size:20})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-full shrink-0 ${d==="danger"?"bg-red-50 text-red-600":"bg-yellow-50 text-yellow-600"}`,children:d==="danger"?e.jsx(xe,{size:24}):e.jsx(se,{size:24})}),e.jsx("p",{className:"text-zinc-600 mt-1",children:t})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-2",children:[e.jsx("button",{type:"button",onClick:s,disabled:c,className:"px-4 py-2 text-sm font-medium text-zinc-700 bg-white border border-zinc-300 rounded-md hover:bg-zinc-50 focus:ring-zinc-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:n}),e.jsxs("button",{type:"button",onClick:()=>{x()},disabled:c,className:`px-4 py-2 text-sm font-medium text-white rounded-md transition-colors flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed ${d==="danger"?"bg-red-600 hover:bg-red-700":"bg-yellow-500 hover:bg-yellow-600"}`,children:[c&&e.jsx(P,{size:"sm"}),c?a+"...":o]})]})]})]})})]})}function be({donation:s,onDelete:r,onUpload:m,onViewResult:t}){const o=h.useRef(null),a=n=>{const d=n.target.files?.[0];d&&m(s.id,d)};return e.jsxs("div",{className:"p-3 sm:p-4 bg-white border border-zinc-200 rounded-md transition-shadow hover:shadow-sm flex justify-between items-start gap-3 sm:gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-1 mb-1.5",children:[e.jsx("p",{className:"font-semibold text-zinc-800",children:s.type}),s.amount>0&&e.jsxs("span",{className:"text-xs text-red-700 bg-red-100 px-2 py-0.5 rounded-full whitespace-nowrap",children:[s.amount," ml"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-zinc-600 mb-1",children:[e.jsx(U,{size:14,className:"shrink-0"}),e.jsx("span",{className:"mt-0.5",children:new Date(s.date).toLocaleDateString("pl-PL")})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-zinc-500",children:[e.jsx(ne,{size:14,className:"shrink-0"}),e.jsx("span",{className:"mt-0.5",children:s.location})]})]}),e.jsxs("div",{className:"flex flex-col min-[360px]:flex-row gap-2 shrink-0",children:[s.results_url?e.jsx("button",{onClick:()=>t(s.results_url),className:"p-2 border cursor-pointer border-blue-200 rounded-md text-blue-500 hover:text-blue-600 hover:bg-blue-50 transition-colors",title:"Zobacz wyniki badań",children:e.jsx(J,{size:20})}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",ref:o,className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:a}),e.jsx("button",{onClick:()=>o.current?.click(),className:"p-2 border cursor-pointer border-zinc-200 rounded-md text-zinc-500 hover:text-zinc-600 hover:bg-zinc-50 transition-colors",title:"Dodaj wyniki badań",children:e.jsx(ie,{size:20})})]}),e.jsx("button",{onClick:()=>r(s.id),className:"p-2 border cursor-pointer border-zinc-200 rounded-md text-zinc-500 hover:text-red-500 hover:bg-red-50 hover:border-red-200 transition-colors",title:"Usuń donację",children:e.jsx(ce,{size:20})})]})]})}const je=({donations:s,onClick:r,onDelete:m,onUpload:t,onViewResult:o})=>e.jsxs(C,{title:"Historia donacji",children:[e.jsx("div",{className:"flex flex-col grow",children:s.length===0?e.jsx("p",{className:"text-zinc-500 text-sm mb-2",children:"Brak zapisanych donacji."}):s.map((a,n)=>e.jsx("div",{className:n===s.length-1?"":"mb-3",children:e.jsx(be,{donation:a,onDelete:m,onUpload:t,onViewResult:o})},a.id))}),e.jsxs("button",{onClick:r,className:"w-full mt-3 bg-red-600 text-white font-semibold py-2.5 px-6 rounded-md hover:bg-red-700 transition-colors flex items-center justify-center gap-2 shadow-sm",children:[e.jsx(oe,{size:20}),"Dodaj donację"]})]});function ge({daysRemaining:s,nextDate:r,progress:m,canDonate:t,targetDonationType:o,onTargetDonationTypeChange:a}){const[n,d]=h.useState(o);t&&n!==o&&d(o);const c=[{id:"krew_pelna",label:"Krew"},{id:"osocze",label:"Osocze"},{id:"plytki_krwi",label:"Płytki"}];return e.jsxs("section",{className:`p-6 rounded-lg border shadow-sm transition-all grid duration-300 ease-in-out ${t?"bg-green-50 border-green-200 grid-rows-[1fr]":"bg-white border-zinc-200 grid-rows-[0fr]"}`,children:[e.jsxs("div",{className:"flex flex-col-reverse md:flex-row md:items-center justify-between mb-1 gap-4",children:[e.jsx("h2",{className:`text-lg font-semibold ${t?"text-green-800":"text-zinc-800"}`,children:"Twój status"}),e.jsx("div",{className:`flex p-1 rounded-lg w-full md:w-auto ${t?"bg-green-900/5":"bg-zinc-100"}`,children:c.map(l=>e.jsx("button",{onClick:()=>a(l.id),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-all flex-1 md:flex-none justify-center ${o===l.id?`bg-white shadow-sm ${t?"text-green-700":"text-zinc-800"}`:`${t?"text-green-800/60 hover:text-green-800":"text-zinc-500 hover:text-zinc-700"}`}`,children:l.label},l.id))})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"min-h-10 flex items-center",children:t?e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-3xl font-bold text-green-600",children:["Możesz już oddać"," ",n==="osocze"?"osocze":n==="plytki_krwi"?"płytki krwi":"krew pełną"]})}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl font-bold text-red-600 whitespace-nowrap shrink-0",children:s>1?`${s} dni`:`${s} dzień`}),e.jsx("span",{className:"text-zinc-600 font-medium leading-tight text-balance",children:o==="osocze"?"do kolejnej donacji osocza":o==="plytki_krwi"?"do kolejnej donacji płytek krwi":"do kolejnej donacji krwi pełnej"})]})}),e.jsx("div",{className:`grid transition-all duration-600 ease-in-out ${t?"grid-rows-[1fr] opacity-100 delay-1200":"grid-rows-[0fr] opacity-0"}`,children:e.jsx("div",{className:"overflow-hidden",children:e.jsx("p",{className:`font-medium transition-colors duration-300 ${t?"text-green-700 mb-1":"text-red-700"}`,children:"Już teraz udaj się do punktu krwiodawstwa i uratuj ludzkie życie"})})})]}),e.jsx("div",{className:`w-full rounded-full h-2.5 overflow-hidden transform-gpu ${t?"bg-green-200":"bg-zinc-100"}`,children:e.jsx("div",{className:`h-full rounded-full transition-[width] duration-600 ease-out ${t?"bg-green-500":"bg-red-600"}`,style:{width:t?"100%":`${m}%`}})}),e.jsx("div",{className:`grid transition-all duration-600 ease-in-out ${t?"grid-rows-[0fr] opacity-0":"grid-rows-[1fr] opacity-100 delay-1200"}`,children:e.jsx("div",{className:"overflow-hidden",children:e.jsxs("p",{className:"text-sm text-zinc-500 mt-6 text-right",children:["Przewidywana data: ",e.jsx("span",{className:"font-medium",children:r})]})})})]})]})}const we=({donations:s})=>{const r=s.reduce((n,d)=>{const c=F(d.type);let l=0;return l=d.amount/1e3,n.total+=l,c==="krew_pelna"&&(n.krew_pelna+=l),c==="osocze"&&(n.osocze+=l),c==="plytki_krwi"&&(n.plytki_krwi+=l),n},{total:0,krew_pelna:0,osocze:0,plytki_krwi:0}),m=parseFloat(r.total.toFixed(2)),t=Math.floor(m/.45*3),o=s.length,a=s.length>0?new Date(Math.max(...s.map(n=>new Date(n.date).getTime()))):null;return e.jsx(C,{title:"Statystyki",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center p-2.5 sm:p-3 bg-red-50/50 rounded-xl border border-red-200",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-red-100 text-red-600 rounded-lg shrink-0 mr-3",children:e.jsx(G,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium text-zinc-700",children:"Uratowane życia"}),e.jsx("span",{className:"text-lg sm:text-xl font-bold text-red-700 leading-none mt-0.5",children:t})]})]}),e.jsxs("div",{className:"flex items-center p-2.5 sm:p-3 bg-red-50/50 rounded-xl border border-red-200",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-red-100 text-red-600 rounded-lg shrink-0 mr-3",children:e.jsx(M,{fill:"currentColor",className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium text-zinc-700",children:"Oddana krew pełna"}),e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-red-700 leading-none mt-0.5",children:[r.krew_pelna===0?"0":r.krew_pelna.toFixed(2)," ",e.jsx("span",{className:"text-xs sm:text-sm font-normal text-zinc-900",children:"L"})]})]})]}),r.osocze>0&&e.jsxs("div",{className:"flex items-center p-2.5 sm:p-3 bg-orange-50/50 rounded-xl border border-orange-200",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-orange-100 text-orange-600 rounded-lg shrink-0 mr-3",children:e.jsx(M,{fill:"currentColor",className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium text-zinc-700",children:"Oddane osocze"}),e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-orange-700 leading-none mt-0.5",children:[r.osocze===0?"0":r.osocze.toFixed(2)," ",e.jsx("span",{className:"text-xs sm:text-sm font-normal text-zinc-900",children:"L"})]})]})]}),r.plytki_krwi>0&&e.jsxs("div",{className:"flex items-center p-2.5 sm:p-3 bg-yellow-50/50 rounded-xl border border-yellow-200",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-yellow-100 text-yellow-600 rounded-lg shrink-0 mr-3",children:e.jsx(M,{fill:"currentColor",className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium text-zinc-700",children:"Oddane płytki krwi"}),e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-yellow-700 leading-none mt-0.5",children:[r.plytki_krwi===0?"0":r.plytki_krwi.toFixed(2)," ",e.jsx("span",{className:"text-xs sm:text-sm font-normal text-zinc-900",children:"L"})]})]})]}),e.jsxs("div",{className:"flex items-center p-2.5 sm:p-3 bg-zinc-50/50 rounded-xl border border-zinc-200",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-white text-zinc-600 rounded-lg border border-zinc-200 shrink-0 mr-3",children:e.jsx(Q,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium text-zinc-700",children:"Liczba donacji"}),e.jsx("span",{className:"text-lg sm:text-xl font-bold text-zinc-900 leading-none mt-0.5",children:o})]})]}),o>0&&e.jsxs("div",{className:"flex items-center p-2.5 sm:p-3 bg-zinc-50/50 rounded-xl border border-zinc-200",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-white text-zinc-600 rounded-lg border border-zinc-200 shrink-0 mr-3",children:e.jsx(U,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium text-zinc-700",children:"Ostatnia donacja"}),e.jsx("span",{className:"text-base sm:text-lg font-bold text-zinc-900 leading-none mt-0.5",children:a?a.toLocaleDateString("pl-PL"):"-"})]})]})]})})};function ye({donations:s}){const r=new Date().getFullYear(),[m,t]=h.useState(r),[o,a]=h.useState(!1),n=h.useRef(null);h.useEffect(()=>{const x=p=>{n.current&&!n.current.contains(p.target)&&a(!1)};return document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}},[]);const{amount:d,donationCount:c}=K(s,m),l=Array.from(new Set(s.map(x=>new Date(x.date).getFullYear()))).sort((x,p)=>p-x).filter(x=>x<=r);return l.includes(r)||l.unshift(r),e.jsx(C,{title:"Kalkulator ulgi podatkowej",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"w-full relative",ref:n,children:[e.jsxs("button",{type:"button",className:"w-full bg-white border border-zinc-200 shadow-xs text-zinc-800 px-4 py-3 text-sm font-medium rounded-lg flex items-center justify-between transition-all hover:bg-zinc-50",onClick:()=>a(!o),children:[e.jsx("span",{children:m}),e.jsx(R,{size:16,className:`text-zinc-400 transition-transform duration-200 ${o?"rotate-180":""}`})]}),o&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-zinc-200 rounded-lg shadow-lg z-10 overflow-hidden",children:e.jsx("div",{className:"max-h-60 overflow-y-auto p-1 no-scrollbar",children:l.map(x=>e.jsxs("button",{onClick:()=>{t(x),a(!1)},className:`w-full px-3 py-2 text-sm font-medium rounded-md transition-all text-left mb-1 last:mb-0 flex items-center justify-between ${m===x?"bg-zinc-100 text-zinc-900":"text-zinc-500 hover:bg-zinc-50 hover:text-zinc-700"}`,children:[x,m===x&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-red-500"})]},x))})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-zinc-200 flex flex-col items-center justify-center text-center shadow-sm",children:[e.jsxs("span",{className:"text-zinc-800 font-bold text-3xl mt-2",children:[d.toFixed(2)," zł"]}),e.jsx("span",{className:"text-zinc-500 text-sm font-medium mt-1",children:"Wysokość ulgi podatkowej"}),e.jsxs("span",{className:"text-zinc-400 text-xs mt-0.5 mb-2",children:["Wyliczono na podstawie ",c," donacji w ",m," ","roku"]})]})]}),e.jsx("a",{href:"https://www.gov.pl/web/nck/po-donacji",target:"_blank",rel:"noopener noreferrer",className:"font-semibold mt-2 text-red-600 hover:underline text-xs text-center block transition-colors",children:"Dowiedz się więcej o uldze podatkowej dla krwiodawców"})]})})}const Ne=[{id:"zhdk-bronze",name:"Zasłużony Honorowy Dawca Krwi III Stopnia",description:"Oddano 6 litrów (mężczyźni) lub 5 litrów (kobiety) krwi.",colors:{bg:"bg-amber-800/10",text:"text-amber-900",border:"border-amber-800",progress:"bg-amber-800"},thresholdLiters:s=>s==="male"?6:5},{id:"zhdk-silver",name:"Zasłużony Honorowy Dawca Krwi II Stopnia",description:"Oddano 12 litrów (mężczyźni) lub 10 litrów (kobiety) krwi.",colors:{bg:"bg-zinc-500/15",text:"text-zinc-600",border:"border-zinc-500",progress:"bg-zinc-500"},thresholdLiters:s=>s==="male"?12:10},{id:"zhdk-gold",name:"Zasłużony Honorowy Dawca Krwi I Stopnia",description:"Oddano 18 litrów (mężczyźni) lub 15 litrów (kobiety) krwi.",colors:{bg:"bg-yellow-500/15",text:"text-yellow-600",border:"border-yellow-500",progress:"bg-yellow-500"},thresholdLiters:s=>s==="male"?18:15},{id:"hdk-zdzn",name:"Honorowy Dawca Krwi - Zasłużony dla Zdrowia Narodu",description:"Oddano 20 litrów krwi.",colors:{bg:"bg-slate-600/15",text:"text-slate-600",border:"border-slate-700",progress:"bg-slate-600"},thresholdLiters:()=>20}],E=({donations:s,gender:r})=>h.useMemo(()=>{const t=s.reduce((p,j)=>{let g=0;if(j.amount)g=j.amount/1e3;else{const k=F(j.type);g=A[k]||0}return p+g},0),o=Ne.map(p=>{const j=p.thresholdLiters(r),g=t>=j;return{...p,isUnlocked:g,threshold:j}}),a=o.filter(p=>p.isUnlocked),n=o.find(p=>!p.isUnlocked),d=a.at(-1)||null;let c=0,l=0,x=0;if(n){x=n.threshold;const p=d?d.threshold:0,j=x-p,g=t-p;c=Math.min(Math.max(g/j*100,0),100),l=Math.max(0,x-t)}else d&&(c=100,x=d.threshold);return{totalLiters:t,badges:o,currentBadge:d,nextBadge:n,progress:c,missingLiters:l.toFixed(2),nextGoalValue:x}},[s,r]),ve=({donations:s,gender:r})=>{const{nextBadge:m,currentBadge:t,progress:o,missingLiters:a}=E({donations:s,gender:r}),n=Math.ceil(parseFloat(a)/.45),d=Number(Number(a).toFixed(2)),c=H(n);if(!m&&t)return e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${t.colors.bg}`,children:e.jsx(L,{className:`w-6 h-6 ${t.colors.text}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-zinc-500",children:"Osiągnięto cel"}),e.jsx("h3",{className:"text-lg font-bold text-zinc-800",children:t.name})]})]})});const l=m||t;return l?e.jsxs("div",{className:"flex flex-col gap-4 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${l.colors.bg}`,children:e.jsx(L,{className:`w-6 h-6 ${l.colors.text}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-zinc-500",children:"Następny cel"}),e.jsx("h3",{className:"text-lg font-bold text-zinc-800",children:l.name})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-full bg-zinc-100 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ease-out ${l.colors.progress}`,style:{width:`${o}%`}})}),e.jsxs("p",{className:"text-sm text-zinc-600",children:["Brakuje Ci ",e.jsxs("span",{className:"font-bold",children:[d," L"]})," (ok."," ",n," ",c,")"]})]})]}):null},ze=({donations:s,gender:r})=>{const{badges:m}=E({donations:s,gender:r}),[t,o]=h.useState(!1);return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("span",{className:"font-medium text-zinc-700",children:"Galeria odznak"}),e.jsx("button",{onClick:()=>o(!t),className:"p-2 rounded-md hover:bg-zinc-100 transition-colors","aria-label":t?"Zwiń galerię":"Rozwiń galerię",children:e.jsx(R,{className:`shrink-0 transition-transform duration-200 ${t?"rotate-180":""}`,size:20})})]}),e.jsx("div",{className:`grid transition-all duration-300 ease-in-out ${t?"grid-rows-[1fr] opacity-100":"grid-rows-[0fr] opacity-0"}`,children:e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 pt-4",children:m.map(a=>{const n=a.isUnlocked;return e.jsxs("div",{className:`
                    relative flex flex-col items-center justify-center p-3 rounded-lg border text-center transition-all
                    ${n?`${a.colors.bg} ${a.colors.border}`:"bg-zinc-50 border-zinc-200 grayscale opacity-60"}
                  `,children:[e.jsx("div",{className:`p-2 rounded-full mb-2 ${n?"bg-white/50":"bg-zinc-200"}`,children:e.jsx(L,{className:`w-6 h-6 ${n?a.colors.text:"text-zinc-500"}`})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:`text-xs font-bold uppercase tracking-wider ${n?a.colors.text:"text-zinc-500"}`,children:a.name}),e.jsxs("p",{className:"text-[10px] font-medium text-zinc-500",children:[a.threshold," litrów"]})]})]},a.id)})})})})]})};function ke(s,r="krew_pelna"){const[m,t]=h.useState([]),[o,a]=h.useState(!0),n=h.useCallback(async()=>{if(s)try{const{data:f,error:u}=await z.from("donations").select("*").eq("user_id",s).order("date",{ascending:!1}).order("created_at",{ascending:!1});if(u)throw u;t(f)}catch(f){console.error(f),y.error("Nie udało się pobrać historii donacji.")}finally{a(!1)}},[s]);h.useEffect(()=>{n()},[n]);const d=m[0],{daysRemaining:c,nextDate:l,progress:x,canDonate:p}=d?q(d.date,d.type,r):{daysRemaining:0,nextDate:new Date().toLocaleDateString("pl-PL"),progress:100,canDonate:!0};return{donations:m,isLoading:o,fetchDonations:n,handleAddDonation:async f=>{try{let u=null;if(f.file){if(f.file.size>S){y.error("Plik jest za duży (max. 2 MB)");return}const N=f.file.name.split(".").pop(),v=`${Math.random()}.${N}`,_=`${s}/${Date.now()}_${v}`,{error:$}=await z.storage.from("donation-results").upload(_,f.file);if($)throw $;u=_}const{error:b}=await z.from("donations").insert([{user_id:s,date:f.date,type:f.type,location:f.location,amount:f.amount,results_url:u}]);if(b)throw b;await n(),y.success("Dodano nową donację")}catch(u){throw console.error(u),y.error("Nie udało się zapisać donacji. Spróbuj ponownie."),u}},handleDeleteDonation:async f=>{try{const{error:u}=await z.from("donations").delete().eq("id",f);if(u)throw u;await n(),y.success("Donacja została usunięta")}catch(u){throw console.error(u),y.error("Nie udało się usunąć donacji. Spróbuj ponownie"),u}},handleUploadResults:async(f,u)=>{if(u.size>S){y.error("Plik jest za duży (max. 2 MB)");return}try{const b=u.name.split(".").pop(),N=`${Math.random()}.${b}`,v=`${s}/${Date.now()}_${N}`,{error:_}=await z.storage.from("donation-results").upload(v,u);if(_)throw _;const{error:$}=await z.from("donations").update({results_url:v}).eq("id",f);if($)throw $;await n(),y.success("Wyniki badań zostały zapisane")}catch(b){throw console.error(b),y.error("Nie udało się przesłać pliku. Spróbuj ponownie."),b}},handleViewResult:async f=>{try{const{data:u,error:b}=await z.storage.from("donation-results").createSignedUrl(f,60);if(b)throw b;u&&window.open(u.signedUrl,"_blank")}catch(u){console.error(u),y.error("Nie udało się otworzyć pliku. Spróbuj ponownie")}},daysRemaining:c,nextDate:l,progress:x,canDonate:p}}function Ce(){const{session:s}=I.useRouteContext(),r=s.user,m=B(),[t,o]=h.useState(!1),[a,n]=h.useState(null),[d,c]=h.useState("krew_pelna"),{donations:l,isLoading:x,handleAddDonation:p,handleDeleteDonation:j,handleUploadResults:g,handleViewResult:k,nextDate:D,daysRemaining:f,canDonate:u,progress:b}=ke(r.id,d);return h.useEffect(()=>{const{data:{subscription:N}}=z.auth.onAuthStateChange(v=>{v==="SIGNED_OUT"&&m({to:"/login"})});return()=>{N.unsubscribe()}},[m]),x?e.jsx("div",{className:"flex justify-center items-center h-[50vh]",children:e.jsx(P,{size:"lg"})}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8 pb-12",children:[e.jsxs("h1",{className:"text-3xl font-bold text-zinc-800",children:["Hej,"," ",e.jsx("span",{className:"text-red-600",children:r?.user_metadata.first_name||"krwiodawco"}),". Dziękujemy za ratowanie życia."]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(ge,{nextDate:D,progress:b,daysRemaining:f,canDonate:u,targetDonationType:d,onTargetDonationTypeChange:c}),e.jsx(je,{donations:l,onClick:()=>o(!0),onDelete:N=>n(N),onUpload:g,onViewResult:k})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{title:"Odznaki",children:[e.jsx(ve,{donations:l,gender:r?.user_metadata?.gender}),e.jsx("div",{className:"my-4 border-t border-zinc-200"}),e.jsx(ze,{donations:l,gender:r?.user_metadata?.gender})]}),e.jsx(we,{donations:l}),e.jsx(ye,{donations:l})]})]}),t&&e.jsx(pe,{onClose:()=>o(!1),onSave:async N=>{await p(N),o(!1)}}),a!==null&&e.jsx(fe,{onClose:()=>n(null),onConfirm:async()=>{a&&(await j(a),n(null))},title:"Usuń donację",description:"Czy na pewno chcesz usunąć tę donację? Tej operacji nie można cofnąć",confirmLabel:"Usuń",confirmLoadingLabel:"Usuwanie",cancelLabel:"Anuluj",variant:"danger"})]})}export{Ce as component};
